name: Security

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]
    schedule:
        - cron: "30 4 * * 1" # Weekly on Mondays

permissions:
    contents: read
    issues: write
    checks: write

jobs:
    audit:
        name: Rust Security Audit
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

            - uses: dtolnay/rust-toolchain@stable
              with:
                  toolchain: stable

            # Use rustsec/audit-check which handles CVSS 4.0 advisories properly
            - name: Run security audit
              uses: rustsec/audit-check@v2.0.0
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}

    # OpenSSF Scorecard disabled for private repositories
    # Re-enable when repository becomes public or when GitHub App permissions are configured
    # scorecard:
    #   name: OpenSSF Scorecard
    #   runs-on: ubuntu-latest
    #   permissions:
    #     security-events: write
    #     id-token: write
    #     contents: read
    #     actions: read
    #   steps:
    #     - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1
    #       with:
    #         persist-credentials: false
    #     - name: Run analysis
    #       uses: ossf/scorecard-action@v2.3.1
    #       with:
    #         results_file: results.sarif
    #         results_format: sarif
    #         publish_results: true
